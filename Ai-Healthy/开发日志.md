# 项目初始化
项目启动方法:
前提: 具备nodejs环境 推荐版本为22版
1. 安装依赖 在当前项目文件夹的目录下执行npm i
2. 启动项目 在项目文件夹的目录下执行npm run dev
## 项目路由配置
项目使用的vite脚手架开发的React 应用,使用React-routerV7,因为是一个简单的前台应用 暂时没有对应的后台应用 所以不需要动态路由 路由结构是静态的
并且这样做项目的路由配置和维护就会很简单 符合现代开规范
## 项目组件库配置
经过我深思熟虑 还是不要使用国外的组件库了 一个比一个难用 可能是我段位太低了 所以我还是使用arco-design组件库 来自字节跳动的组件库 这个组件库的使用文档比较完善 也有比较多的示例 所以我还是选择使用这个组件库
# 项目结构与功能
1. 先做web端的简单应用 后续拓展成移动端引用
2. 使用Grid布局 先搭建静态页面 然后根据需求编写业务
3. 前端业务功能
    1. 聊天功能,并且可以让ai根据用户输入的数据 增加删除修改数据展示页面的数据
    2. 分析功能 实现文件上传功能 让ai分析上传的文件 返回对应的数据 然后前端将对应数据渲染到分析界面 前端处理后端发送的sse数据流
    3. 个人中心功能 实现用户信息的展示和修改 利用表单和模态框来实现用户设置 个人信息修改
    4. 用户注册登录 实现用户注册和登录 使用jwt的方式验证 将token存储在redux并对localStorage做持久化操作
    5. 后续业务能力实现
        1. 用户喜好记忆功能 使用心跳机制 定时发送用户输入的数据 并根据用户输入的数据 调整ai的回答
        2. 首页实时推荐功能 利用用户喜好记忆功能 实时推荐用户可能感兴趣的内容
4. node附属层业务
    1. 实现用户登录注册功能 利用node的express框架 实现用户登录注册功能 并将用户信息存储到数据库中
    2. 实现文件上传功能 利用node的express框架 实现文件上传功能 并将文件存储到服务器中
    3. 实现ai分析 使用node层对前端传回的消息进行处理 然后调用ai模型 对消息进行分析 最后将分析结果通过sse发送到前端
    4. ai聊天 node层处理ai服务器发送的流式数据 并将数据通过sse发送到前端
页面布局:
登录注册
首页_>
    导航栏
    侧边栏
    内容区域
        聊天界面
        食品分析界面
        个人中心
        信息设置 提醒设置 喜好设置
# 登录/注册页面的开发
完成静态页面编写后 自己编写mock数据用来模拟后端接口 然后编写http请求 本项目请求主要使用axios库 来发送http请求 并处理响应数据
将不同请求都封装成函数 方便后续调用 并处理响应数据
## 登录页面开发流程
1. 用户填写完登录信息,前端向后端发送登录请求 接受响应结果 
   1. 如果登录成功 前端将token存储到Redux中并且持久化 后续请求在请求头中设置token 为后续个性化服务提供便利
   2. 成功登录 弹出登录成功提示 并跳转首页
2. 在首页做路由守卫 如果检测不到token就跳转到登录页面
注意写完mock要在主页面中引入mock,因为本项目不是团队开发也不是大型项目 所以状态管理使用的是zustand

## zustand使用方法
1. 安装zustand
2. 创建一个store 用来存储状态
3. 在组件中使用useStore 来获取状态和更新状态
创建仓库
```js
import { create } from 'zustand';

// 1. 创建状态仓库：包含「状态」和「修改状态的方法」
const useUserStore = create((set) => ({
  // ---- 定义全局状态 ----
  token: '',        // 用户 Token
  username: '',     // 用户名
  isLogin: false,   // 是否登录

  // ---- 定义修改状态的方法 ----
  // 登录：更新状态 + 存储 Token 到本地
  login: (token, username) => {
    localStorage.setItem('token', token); // 存到本地，实现免登
    // set 方法用于更新状态（类似 React 的 setState）
    set({ token, username, isLogin: true });
  },

  // 退出登录：清空状态 + 清除本地 Token
  logout: () => {
    localStorage.removeItem('token');
    set({ token: '', username: '', isLogin: false });
  },

  // 初始化：页面加载时从本地读取 Token，恢复登录状态
  initUser: () => {
    const token = localStorage.getItem('token');
    const username = localStorage.getItem('username') || '';
    if (token) {
      set({ token, username, isLogin: true });
    }
  }
}));

export default useUserStore;
```
从仓库中获取状态和更新状态
```js
// src/pages/Login.jsx
import React, { useState } from 'react';
import useUserStore from '../store/userStore';

const Login = () => {
  const [inputName, setInputName] = useState('');
  // 从仓库中取出 login 方法（仅取需要的方法，性能更好）
  const login = useUserStore(state => state.login);

  // 模拟登录按钮点击
  const handleLogin = () => {
    if (!inputName) return alert('请输入用户名');
    // 调用仓库的 login 方法，更新全局状态
    login('mock-token-123456', inputName);
    alert('登录成功！');
  };

  return (
    <div style={{ padding: 20 }}>
      <input
        placeholder="请输入用户名"
        value={inputName}
        onChange={(e) => setInputName(e.target.value)}
        style={{ marginBottom: 10, padding: 8 }}
      />
      <button onClick={handleLogin} style={{ padding: 8, cursor: 'pointer' }}>
        登录
      </button>
    </div>
  );
};

export default Login;
```

```js
// src/pages/Home.jsx
import React from 'react';
import useUserStore from '../store/userStore';

const Home = () => {
  // 方式 1：批量读取多个状态（推荐，减少重渲染）
  const { isLogin, username, logout } = useUserStore(state => ({
    isLogin: state.isLogin,
    username: state.username,
    logout: state.logout
  }));

  if (!isLogin) {
    return <div>请先 <a href="/login">登录</a></div>;
  }

  return (
    <div style={{ padding: 20 }}>
      <h3>欢迎你，{username}！</h3>
      <button onClick={logout} style={{ padding: 8, cursor: 'pointer' }}>
        退出登录
      </button>
    </div>
  );
};

export default Home;
```
## token持久化
业务逻辑流程
1. 应用启动 → 从localStorage读取token等认证信息
2. 用户登录 → 设置登录状态并保存到localStorage
3. 用户操作 → 状态变更自动持久化
4. 页面刷新 → 从localStorage恢复状态，保持登录状态
5. 用户登出 → 清除localStorage中的认证信息
   
问题: 在对token进行简单的持久化处理后 在首页我将token删除 不会自动跳转到登录页面 需要刷新后才会实现
实现持久化自动监听token 页面刷新时检查token是否存在 如果不存在则跳转到登录页

# 将原型图迁移到了Ai-Healthy项目中
下一步开始编写进入首页后的业务逻辑
首页业务逻辑分析:
  包含信息:
    1. 数据展示: 用户名 日期 用户头像 用户今日可摄入热量 以及各个数据的展示
    2. 导航栏: 包含咨询 分析 我的 三个选项 点击后跳转到对应的页面
      2.1 咨询: 点击后跳转到ai聊天页面
      2.2 分析: 点击后跳转到分析页面 用于上传食物图片 并收集为json 发送给后端 后端交由ai分析 分析后后端转回结果 前端将收集到的结果放置在首页
      2.3 我的: 点击后跳转到我的页面  
        2.3.1 提醒设置: 点击后跳转到提醒设置页面 用于设置提醒时间 以及是否开启提醒
        2.3.2 账号管理: 点击后跳转到账号管理页面 用于修改密码 以及删除账号
后续打算 将原型图逐步替换为antd组件 尽量保持样式不改变


# 后续功能设计

## 1. 历史数据展示
## 2. 我的体重历史数据与分析图